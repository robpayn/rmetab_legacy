close <- function(x, ...){   UseMethod("close");}getDeploymentTimeSeries <- function(x, ...){   UseMethod("getDeploymentTimeSeries");}getTimeSeries <- function(x, ...){   UseMethod("getTimeSeries");}open <- function(x, ...){   UseMethod("open");}as.envdb <- function(object){   require(RODBC);   attr(object, "class") <- "envdb";   object;}new.envdb <- function(odbcString){   object <- new.env();   object$odbcString <- odbcString;   as.envdb(object);}close.envdb <- function(envdb){   odbcClose(envdb$channel);}getDeploymentTimeSeries.envdb <- function(envdb, property, timeRange, sites=NULL, instruments=NULL){   sql <- paste(      "SELECT [core_data].[Time], ",         "[src_instruments].[Name] AS [Instrument], ",         "[dim_type_values].[Value] AS [", property, "], ",         "[core_sites].[Name] AS [Site] ",      "FROM ((([core_data] ",         "INNER JOIN [core_properties] ",         "ON [core_data].[PropertyID] = [core_properties].[ID]) ",         "INNER JOIN [dim_type_values] ",         "ON [dim_type_values].[DatumID] = [core_data].[ID]) ",         "INNER JOIN [core_sites] ",         "ON [core_data].[SiteID] = [core_sites].[ID]) ",         "INNER JOIN ([core_sources] ",            "INNER JOIN ([src_type_deployments] ",               "INNER JOIN [src_instruments] ",               "ON [src_type_deployments].[InstrumentID] = ",                  "[src_instruments].[ID]) ",            "ON [src_type_deployments].[SourceID] = [core_sources].[ID]) ",         "ON [core_data].[SourceID] = [core_sources].[ID] ",      "WHERE [core_properties].[Name] = '", property, "'",      sep="");         if (!is.null(sites))   {      for (i in 1:length(sites))      {         sql <- paste(            sql,            " AND [core_sites].[Name] ", sites[i],             sep="");      }   }      if (!is.null(instruments))   {      for (i in 1:length(instruments))      {         sql = paste(            sql,            " AND [src_instruments].[Name] = '", instruments[i], "'",             sep="");      }   }      sql = paste(      sql,      " AND [Time] >= #", timeRange[1] ,"#",      " AND [Time] <= #", timeRange[2] ,"#",      " ORDER BY [core_data].[Time]",      sep="");         sqlQuery(envdb$channel, sql);}getTimeSeries.envdb <- function(envdb, property, timeRange, sites=NULL, sources=NULL){   sql <- paste(      "SELECT [core_data].[Time], ",         "[dim_type_values].[Value] AS [", property, "], ",         "[core_sites].[Name] AS [Site] ",      "FROM (((([core_data] ",         "INNER JOIN [core_properties] ",         "ON [core_data].[PropertyID] = [core_properties].[ID]) ",         "INNER JOIN [dim_type_values] ",         "ON [dim_type_values].[DatumID] = [core_data].[ID]) ",         "INNER JOIN [core_sites] ",         "ON [core_data].[SiteID] = [core_sites].[ID]) ",         "INNER JOIN [core_sources] ",         "ON [core_data].[SourceID] = [core_sources].[ID]) ",      "WHERE [core_properties].[Name] = '", property, "'",      sep = "");         if (!is.null(sites))   {      for (i in 1:length(sites))      {         sql <- paste(            sql,            " AND [core_sites].[Name] ", sites[i],             sep="");      }   }   if (!is.null(sources))   {      for (i in 1:length(sources))      {         sql <- paste(            sql,            " AND [core_sources].[Name] ", sources[i],             sep="");      }   }      sql = paste(      sql,      " AND [Time] >= #", timeRange[1] ,"#",      " AND [Time] <= #", timeRange[2] ,"#",      " ORDER BY [core_data].[Time]",      sep="");         sqlQuery(envdb$channel, sql);}open.envdb <- function(envdb){   envdb$channel <- odbcDriverConnect(envdb$odbcString);}